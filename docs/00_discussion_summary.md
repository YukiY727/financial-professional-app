# 議論サマリー - クイックリファレンス

**作成日**: 2025-11-16

---

## 🎯 決定事項（重要な合意）

### 1. 開発方針

```
✅ 進化的アーキテクチャ + 曳光弾型開発
✅ 一般ユーザー → 投資家 → FP士へ段階的拡張
✅ 技術的負債を記録し、計画的に返済
```

---

### 2. 曳光弾経路

```
第1弾: UC-001（老後までにいくら貯まるか）
   ↓
第2弾: UC-002（年次キャッシュフロー推移）
   ↓
第3弾: UC-101（投資リターンを含めた資産推移）
```

---

### 3. 主要な設計決定

| 項目 | 決定内容 | 理由 |
|------|---------|------|
| **支出入力** | ハイブリッド（簡易/詳細） | 柔軟性とシンプルさの両立 |
| **支出指定方法** | 固定額 or %選択可 | ユーザーの好みに対応 |
| **税金計算** | 正確な計算（累進課税等） | コア機能のため妥協なし |
| **期待リターン** | デフォルト + カスタム可 | 初心者と上級者の両対応 |
| **データ構造** | ネスト構造 | 拡張性と可読性 |
| **マスター管理** | Phase 1: ハードコード<br>Phase 2: 設定ファイル<br>Phase 3: DB | 段階的な進化 |
| **配偶者/扶養控除** | 後で追加 | 最小限で開始、段階的拡張 |
| **年収更新** | 年末更新 | 自然な流れ |

---

## 📋 ユースケース（レイヤー別）

### Layer 1: 基礎
- UC-001: 老後までにいくら貯まるか

### Layer 2: 中級
- UC-002: 年次CF推移
- UC-004: 貯金率比較
- UC-005: 退職年齢比較
- UC-006: 税金詳細表示

### Layer 3: ライフイベント
- UC-003: ライフイベント影響

### Layer 4: 投資導入
- UC-101: 投資リターン含む推移

### Layer 5: 投資最適化
- UC-102: NISA提案
- UC-103: iDeCo活用
- UC-104: 口座使い分け
- UC-107: 税引後最大化

### Layer 6: 投資高度分析
- UC-105: 確率分布MC
- UC-106: ポートフォリオ最適化

### Layer 7: 意思決定記録
- UC-108: 記録【第1弾】
- UC-109: 振り返り【第2弾】
- UC-110: タイムライン可視化【第3弾】
- UC-111: パターン分析

### Layer 8: FP専門
- UC-201-205: レポート等

---

## 🧮 税金計算の仕様（Phase 1）

### 給与所得控除
- 6段階テーブル
- 上限195万円

### 所得税
- 7段階累進課税（5%〜45%）
- 復興特別所得税 2.1%

### 住民税
- 所得割 10%
- 均等割 5,000円

### 社会保険料
- 厚生年金: 9.15%
- 健康保険: 5%
- 雇用保険: 0.6%

### 基礎控除
- 480,000円

---

## 📊 データモデル（簡易版）

### 入力
```json
{
  "profile": {年齢、年収、昇給率等},
  "expense_mode": "simple" or "detailed",
  "simple_expense": {貯金率},
  "detailed_expense": {住居費、生活費、その他}
}
```

### 年次レコード
```json
{
  "year": 2024,
  "age": 30,
  "income": {総収入、控除、課税所得},
  "tax": {所得税、住民税、社保、合計},
  "net_income": 手取り,
  "expense": {住居、生活、その他、合計},
  "savings": {年間、累計}
}
```

---

## 🏗️ 技術的負債（優先順位順）

### 高優先度
1. **控除項目追加** (DEBT-002)
   - 配偶者控除、扶養控除
   - 期限: UC-002後すぐ

2. **エラーハンドリング** (DEBT-005)
   - 包括的バリデーション
   - 期限: UC-002リリース前

### 中優先度
3. **マスター設定ファイル化** (DEBT-001)
   - YAML/JSON化
   - 期限: UC-003実装時

4. **MCシミュレーション** (DEBT-004)
   - 確率分布対応
   - 期限: UC-105実装時

### 低優先度
5. **標準報酬月額** (DEBT-003)
   - 正確な等級テーブル
   - 期限: 精度向上要求時

6. **マスターDB化** (DEBT-001続き)
   - データベース管理
   - 期限: スケール時

---

## 📁 作成したドキュメント

1. **README.md** - プロジェクト概要
2. **01_specification_overview.md** - 詳細仕様書
3. **TECHNICAL_DEBT.md** - 技術的負債管理
4. **00_discussion_summary.md** - このファイル

---

## 🚀 次のアクション

### 推奨順序
1. **テストケース作成**
   - 具体的な入力と期待値
   - 計算の妥当性検証

2. **アーキテクチャ設計**
   - モジュール分割
   - クラス/関数設計

3. **実装開始**
   - 言語/FW選定
   - UC-001コーディング

---

## 💡 設計思想

### なぜ「同時に」やるか
- **過去**: FPツールは分野ごとに分断
- **現在**: 技術的に統合シミュレーション可能
- **未来**: 税制変更の追跡が重要

### 曳光弾のメリット
- 早期に全体を貫通
- リスクを早期発見
- フィードバックを得やすい

### 進化的アーキテクチャのメリット
- 段階的な価値提供
- 学習しながら改善
- 過剰設計を避ける

---

## 📌 重要な数字

### 制度（2024年度）
- NISA年間上限: 360万円
- NISA生涯上限: 1,800万円
- iDeCo上限（会社員・企業年金なし）: 月23,000円
- 資本利得税率: 20.315%

### 入力制約
- 年齢: 20-70歳
- 退職年齢: 80歳まで
- 年収: 〜1億円
- 昇給率: -10%〜20%

---

## 🔗 関連ファイル

- 詳細仕様: `01_specification_overview.md`
- 技術的負債: `TECHNICAL_DEBT.md`
- プロジェクト概要: `README.md`

---

## ✅ チェックリスト（実装前確認）

- [x] ユースケース整理完了
- [x] データモデル設計完了
- [x] 税金計算仕様確定
- [x] 技術的負債記録完了
- [ ] テストケース作成
- [ ] アーキテクチャ設計
- [ ] 実装開始

---

**次回開始時の質問**:
- テストケース作成から始めますか？
- アーキテクチャ設計から始めますか？
- 実装（言語選定）から始めますか？