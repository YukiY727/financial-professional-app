# Claude Code プロジェクト方針

このドキュメントは、Claude Codeがこのプロジェクトで従うべき開発管理の方針と意思決定の原則を定義します。

---

## 🎯 プロジェクト概要

**ライフプラン・投資シミュレーションシステム**

金融計算の正確性を最重視した、個人のライフプラン管理と投資シミュレーションを行うアプリケーション。

---

## 📐 開発管理アプローチ

### 進化的アーキテクチャ (Evolutionary Architecture)

アーキテクチャを事前に完全に設計するのではなく、**段階的に進化**させていく。

**基本原則:**

- **適応性**: 変化に対応できる構造を維持
- **段階的成長**: Phase 1 → Phase 2 → Phase 3 と進化
- **測定駆動**: 問題を測定してから解決策を導入
- **リファクタリング**: 継続的な改善を前提とする

### 曳光弾型開発 (Tracer Bullet Development)

システム全体を貫通する最小機能を先に実装し、段階的に機能を拡張していく。

```
UC-001 (老後までにいくら貯まるか)
  ↓ フィードバック・学習
UC-002 (年次キャッシュフロー推移)
  ↓ フィードバック・学習
UC-101 (投資リターンを含めた資産推移)
  ↓ ...
```

**重要な原則:**
- 仕様は流動的であり、ユーザーフィードバックを得ながら進化させる
- 各段階で学びを得て、次の設計に活かす
- 過度な事前設計は避け、実装を通じて理解を深める

### アーキテクチャ進化の戦略

```
Phase 1: シンプルな構成
  - 手続き型・関数型での実装
  - ハードコードされたマスターデータ
  - 単一ファイル構成
  ↓ 測定: 複雑性が増した時点で移行

Phase 2: モジュール化
  - 必要に応じてOOP化
  - 設定ファイル化
  - ディレクトリ構造の整理
  ↓ 測定: スケール問題が発生した時点で移行

Phase 3: スケールアーキテクチャ
  - マイクロサービス化（必要なら）
  - DB化
  - 分散システム
```

**重要**: 各フェーズの移行は**測定結果に基づいて**判断する。憶測で移行しない。

---

## 🧪 仕様モデルベース開発

### 基本方針

仕様ドキュメントから具体例を抽出し、実行可能な形式で記述する。

**なぜ具体例ベースか？**
- ✅ 仕様が流動的なフェーズに適している
- ✅ 段階的に拡張可能
- ✅ 実装の正確性を検証できる
- ✅ リファクタリングの安全網になる

### 段階的な進化

```
Phase 1: 基本的な具体例
  ↓
Phase 2-3: 具体例の蓄積 + 性質ベースの検証
  ↓
Phase 4+: 必要に応じて厳密な検証手法を追加
```

**重要**: 実装手法は柔軟に選択する。具体例の形式やツールは状況に応じて変更可能。

---

## 🔄 技術的負債の管理

### 原則

- **記録**: すべての妥協点を明確に記録
- **計画**: 返済時期と方法を明示
- **優先順位**: ビジネス価値と技術的影響で判断
- **透明性**: チーム全体で負債を共有

### 管理方法

- 技術的負債は `docs/techinical_debt.md` に記録
- 各負債には以下を明記:
  - 現状と問題点
  - ビジネス・技術的影響
  - 返済計画と期限

詳細は [技術的負債管理ドキュメント](docs/techinical_debt.md) を参照。

---

## 🎯 優先順位と価値観

### 1. **正確性** > 速度
- 金融計算のバグは信頼を失う
- 実装の正確性を検証する仕組みを持つ

### 2. **早期フィードバック**
- 早くリリースして学ぶ
- MVP、段階的リリース
- ユーザーの反応を次の設計に活かす

### 3. **保守性**
- 長期運用を前提とした設計
- 変更に強い構造
- テストとドキュメントの整備

### 4. **YAGNI (You Aren't Gonna Need It)**
- 今必要なものだけを作る
- 過度な抽象化・最適化は避ける
- 問題を測定してから最適化する

### 5. **トレードオフの明示**
- すべての設計はトレードオフ
- 選択の理由を明確にする
- 複数の選択肢を検討する

---

## 📁 ドキュメント構成

```
financial-professional-app/
├── claude.md                           # このファイル (開発管理方針)
├── docs/
│   ├── 00_discussion_summary.md        # 意思決定のサマリー
│   ├── 01_specification_overview.md    # 仕様概要
│   ├── architecture_philosophy.md      # アーキテクチャ選択の哲学
│   ├── evolutionary_architecture.md    # 進化的アーキテクチャの詳細
│   ├── techinical_debt.md              # 技術的負債の記録
│   └── specification_by_example.md     # 仕様モデルベース開発の実践ガイド
└── (実装コード)                         # 柔軟に構成
```

---

## 📝 Claude Codeへの指示

### 意思決定の原則

1. **重要な決定は必ずユーザーに確認**
   - 技術選択、アーキテクチャ変更など
   - トレードオフを明示する
   - 複数の選択肢を提示する

2. **段階的な実装**
   - 最小限の実装から始める
   - 動くものを早く作る
   - フィードバックを得てから次に進む

3. **柔軟性の維持**
   - 実装手法は状況に応じて選択
   - 過度な制約を設けない
   - 学びに応じて方針を調整

4. **透明性**
   - 設計判断を `docs/` に記録
   - 技術的負債を記録
   - 変更の理由を明確にする

### ドキュメント管理

- **claude.md**: 開発管理の方針のみ記述 (技術選定は含めない)
- **docs/**: 詳細な仕様、設計判断、実践ガイド
- **実装**: 柔軟に進化させる

### コミュニケーション

- 仮定を明示する
- 不明点は質問する
- 選択肢を提示する
- トレードオフを説明する

---

## 🚀 現在のフェーズ

**Phase 1**: UC-001の実装準備中

### 進行中のタスク
- UC-001の具体例を作成
- 具体例をテストケースに変換
- 税金計算ロジックを実装
- UC-001のシミュレーションエンジンを実装

---

## 📚 関連ドキュメント

- [仕様概要](docs/01_specification_overview.md): システム全体の仕様
- [アーキテクチャ哲学](docs/architecture_philosophy.md): 技術選択の思想
- [技術的負債](docs/techinical_debt.md): 負債の記録と返済計画
- [仕様モデルベース開発](docs/specification_by_example.md): 実践ガイド

---

## 🎓 設計思想

### なぜ曳光弾型か

- **早期に全体を貫通**: リスクを早期発見
- **フィードバック**: 実装を通じて学ぶ
- **柔軟性**: 要件変化に対応しやすい

### なぜ段階的か

- **価値提供**: 早期に価値を届ける
- **学習**: 実装しながら理解を深める
- **過剰設計回避**: 必要になってから作る

### なぜ技術的負債を記録するか

- **透明性**: チーム全体で共有
- **計画的**: 意図的に負債を選択
- **返済**: 適切なタイミングで返済

---

**最終更新**: 2025-11-29
